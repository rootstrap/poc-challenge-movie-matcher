package com.swmansion.rnscreens

import android.app.Activity
import android.os.Bundle
import android.view.LayoutInflater
import com.bumptech.glide.Glide
import com.bumptech.glide.load.engine.DiskCacheStrategy
import com.bumptech.glide.load.resource.drawable.DrawableTransitionOptions
import com.google.android.material.snackbar.Snackbar
import com.swmansion.rnscreens.databinding.ActivityMovieDetailBinding
import com.swmansion.rnscreens.models.Movie

class MovieDetailActivity : Activity() {

    private lateinit var binding: ActivityMovieDetailBinding
    private lateinit var genresAdapter: GenreListAdapter

    private var movie = Movie(
        genres = listOf("Action", "SCI-FI", "Drama"),
        title = "Wakanda forever",
        id = 1.0,
        overview = "Queen Ramonda, Shuri, M'Baku, Okoye and the Dora Milaje fight to protect their nation from intervening world powers in the wake of King T'Challa's death. As the Wakandans strive to embrace their next chapter, the heroes must band together with the help of War Dog Nakia and Everett Ross and forge a new path for the kingdom of Wakanda.",
        posterPath = "https://image.tmdb.org/t/p/original//sv1xJUazXeYqALzczSZ3O6nkH75.jpg",
        isInMyList = false,
        isRecommended = false
    )

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMovieDetailBinding.inflate(LayoutInflater.from(this))
        setContentView(binding.root)
        initView()
    }

    private fun initView() {
        binding.backBtn.setOnClickListener {
            finish()
        }

        binding.recommendBtn.setOnClickListener {
            onRecommendClick()
        }

        binding.addToListBtn.setOnClickListener {
            onAddToMyListClick()
        }

        Glide.with(applicationContext)
            .load(movie.posterPath)
            .transition(
                DrawableTransitionOptions.withCrossFade().transition(android.R.anim.fade_in)
            )
            .diskCacheStrategy(DiskCacheStrategy.ALL)
            .centerCrop()
            .into(binding.movieImage)

        initGenresList(movie.genres)
        binding.overview.text = movie.overview
    }

    private fun initGenresList(genres: List<String>) {
        genresAdapter = GenreListAdapter(genres)
        binding.genresList.adapter = genresAdapter
    }

    private fun onRecommendClick() {
        val isRecommended = movie.isRecommended
        if (isRecommended) {
            Snackbar.make(binding.root, "Removed from your recommendations", Snackbar.LENGTH_LONG)
                .show()
            binding.recommendBtn.text = getString(R.string.recommend)

        } else {
            Snackbar.make(binding.root, "Added to your recommendations", Snackbar.LENGTH_LONG)
                .show()
            binding.recommendBtn.text = getString(R.string.remove_recommendation)
        }
        movie = movie.copy(isRecommended = isRecommended.not())
    }

    private fun onAddToMyListClick() {
        val isInMyList = movie.isInMyList
        if (isInMyList) {
            Snackbar.make(binding.root, "Removed from your watch list", Snackbar.LENGTH_LONG).show()
            binding.addToListBtn.text = getString(R.string.add_to_my_list)
        } else {
            Snackbar.make(binding.root, "Added to your watch list", Snackbar.LENGTH_LONG).show()
            binding.addToListBtn.text = getString(R.string.remove_my_list)
        }

        movie = movie.copy(isInMyList = isInMyList.not())
    }
}